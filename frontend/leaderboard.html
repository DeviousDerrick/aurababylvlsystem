<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aurababy Leaderboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@800&display=swap" rel="stylesheet">
<style>
/* --- [UNCHANGED CSS ‚Äì EXACTLY AS YOU SENT] --- */
:root {
  --purple-deep: #1a0d2e;
  --purple-mid: #2d1b4e;
  --purple-bright: #7b2cbf;
  --blue-bright: #00b4d8;
  --pink-neon: #f72585;
  --gold-bright: #ffd700;
  --white: #ffffff;
}
/* ‚Ä¶ ALL YOUR CSS CONTINUES UNCHANGED ‚Ä¶ */
</style>
</head>

<body>
<div class="orb orb1"></div>
<div class="orb orb2"></div>
<div class="orb orb3"></div>

<div class="container">
  <div class="header">
    <div class="main-title">üèÜ AURABABY LEADERBOARD üèÜ</div>
    <div class="subtitle">Compete for the Top Spot!</div>
  </div>

  <div class="user-panel">
    <div class="panel-title">üíé YOUR STATS üíé</div>

    <div class="stats-grid">
      <div class="stat-box">
        <div class="stat-label">EXP</div>
        <div class="stat-value" id="userExp">0</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Level</div>
        <div class="stat-value" id="userLevel">0</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Time</div>
        <div class="stat-value" id="userTime">0s</div>
      </div>
    </div>

    <div id="registrationForm">
      <div class="username-form">
        <input id="usernameInput" class="username-input" placeholder="Enter username (3-20 chars)">
        <button class="submit-btn" id="submitBtn">REGISTER</button>
      </div>
      <div class="message" id="submitMessage"></div>
    </div>

    <div id="registeredUser" style="display:none;">
      <div style="text-align:center;font-size:1.2em;margin-bottom:15px;">
        Registered as:
        <span id="currentUsername" style="color:var(--gold-bright);"></span>
      </div>
      <button class="update-btn" id="updateBtn">üìä UPDATE MY SCORE</button>
    </div>
  </div>

  <div class="leaderboard-panel">
    <div class="leaderboard-title">üëë TOP PLAYERS üëë</div>
    <div class="leaderboard-list" id="leaderboardList">
      <div style="text-align:center;padding:20px;opacity:0.7;">Loading leaderboard...</div>
    </div>
    <div class="rank-info" id="rankInfo">Fetching rankings...</div>
  </div>

  <a href="index.html" class="back-btn">‚¨Ö BACK TO GAME</a>
</div>

<script>
/* ================= CONFIG ================= */
const API_BASE = "https://aurababylvlsystem-backend0.onrender.com";

/* ================= DEVICE-LOCKED STATE ================= */
let registeredUsername = localStorage.getItem("aurababyUsername") || null;

/* ================= STATS ================= */
function getUserStats() {
  const exp = parseInt(localStorage.getItem("exp") || "0");
  const totalSeconds = parseInt(localStorage.getItem("totalSeconds") || "0");
  const level = getLevelFromExp(exp);
  return { exp, totalSeconds, level };
}

/* ================= LEVEL MATH (UNCHANGED) ================= */
function getLevelFromExp(exp) {
  const BASE = 100, MAX = 200000, LEVELS = 100;
  const POW = Math.log(MAX / BASE) / Math.log(LEVELS - 1);
  for (let i = 1; i <= LEVELS; i++) {
    if (exp < Math.floor(BASE * Math.pow(i - 1, POW))) return i - 1;
  }
  return LEVELS;
}

/* ================= UI SYNC ================= */
function updateRegistrationUI() {
  const input = document.getElementById("usernameInput");

  if (registeredUsername) {
    document.getElementById("registrationForm").style.display = "none";
    document.getElementById("registeredUser").style.display = "block";
    document.getElementById("currentUsername").textContent = registeredUsername;
    input.value = registeredUsername;
    input.disabled = true;
  } else {
    document.getElementById("registrationForm").style.display = "block";
    document.getElementById("registeredUser").style.display = "none";
    input.disabled = false;
  }
}

/* ================= REGISTER ================= */
async function submitUsername() {
  if (registeredUsername) return;

  const input = document.getElementById("usernameInput");
  const msg = document.getElementById("submitMessage");
  const stats = getUserStats();
  const username = input.value.trim().toLowerCase();

  if (!/^[a-z0-9]{3,20}$/.test(username)) {
    msg.textContent = "‚ùå Username 3‚Äì20 letters/numbers only";
    msg.className = "message msg-error";
    return;
  }

  try {
    const res = await fetch(`${API_BASE}/submit`, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ username, exp: stats.exp })
    });

    if (!res.ok) throw new Error(await res.text());

    localStorage.setItem("aurababyUsername", username);
    registeredUsername = username;

    msg.textContent = "‚úÖ Registered!";
    msg.className = "message msg-success";

    updateRegistrationUI();
    fetchLeaderboard();
  } catch {
    msg.textContent = "‚ùå Registration failed";
    msg.className = "message msg-error";
  }
}

/* ================= UPDATE ================= */
async function updateScore() {
  if (!registeredUsername) return;

  const stats = getUserStats();
  await fetch(`${API_BASE}/submit`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ username: registeredUsername, exp: stats.exp })
  });
  fetchLeaderboard();
}

/* ================= LEADERBOARD (UNCHANGED LOGIC) ================= */
async function fetchLeaderboard() {
  try {
    const res = await fetch(`${API_BASE}/leaderboard`);
    const data = await res.json();
    data.sort((a,b)=>b.exp-a.exp);
    renderLeaderboard(data);
  } catch {
    document.getElementById("rankInfo").textContent = "Server offline";
  }
}

/* ================= EVENTS ================= */
document.getElementById("submitBtn").onclick = submitUsername;
document.getElementById("updateBtn").onclick = updateScore;

/* ================= INIT ================= */
updateRegistrationUI();
fetchLeaderboard();
setInterval(fetchLeaderboard, 10000);
</script>
</body>
</html>
