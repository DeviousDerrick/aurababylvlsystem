<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aurababy Leaderboard</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@800&display=swap" rel="stylesheet">

<style>
body {
  margin:0;
  font-family:Poppins,sans-serif;
  font-weight:800;
  background:linear-gradient(135deg,#1a0d2e,#2d1b4e);
  color:#fff;
}
.container {
  max-width:800px;
  margin:40px auto;
}
h1 {
  text-align:center;
  margin-bottom:10px;
}
.panel {
  background:rgba(255,255,255,0.07);
  border-radius:16px;
  padding:20px;
  margin-bottom:20px;
}
input, button {
  font-family:Poppins,sans-serif;
  font-weight:800;
  padding:12px;
  border-radius:10px;
  border:none;
}
input {
  width:100%;
  background:rgba(255,255,255,0.15);
  color:white;
  margin-bottom:10px;
}
button {
  width:100%;
  background:linear-gradient(135deg,#7b2cbf,#00b4d8);
  color:white;
  cursor:pointer;
}
button:disabled {
  opacity:.6;
  cursor:not-allowed;
}
.message {
  text-align:center;
  min-height:24px;
  margin-top:10px;
}
.success { color:#ffd700; }
.error { color:#f72585; }

.leaderboard-item {
  display:flex;
  justify-content:space-between;
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,0.15);
}
.rank {
  width:40px;
}
</style>
</head>

<body>
<div class="container">

<h1>üèÜ AURABABY LEADERBOARD</h1>

<div class="panel">
  <input id="usernameInput" placeholder="Enter username (3‚Äì20 chars)">
  <button id="submitBtn">REGISTER / UPDATE</button>
  <div id="submitMessage" class="message"></div>
</div>

<div class="panel">
  <div id="leaderboardList">Loading leaderboard‚Ä¶</div>
</div>

</div>

<script>
/* ================= CONFIG ================= */

const API_BASE = "https://aurababylvlsystem-backend0.onrender.com"; // ‚Üê CHANGE THIS

/* ================= STATE ================= */

let registeredUsername = sessionStorage.getItem("aurababyUsername") || null;

/* ================= HELPERS ================= */

function getExp() {
  return Number(localStorage.getItem("exp")) || 0;
}

function escapeHtml(str) {
  return str.replace(/[&<>"']/g, m =>
    ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])
  );
}

/* ================= SUBMIT ================= */

async function submitUsername() {
  const input = document.getElementById("usernameInput");
  const msg = document.getElementById("submitMessage");
  const btn = document.getElementById("submitBtn");

  const username = input.value.trim().toLowerCase();
  const exp = getExp();

  if (username.length < 3 || username.length > 20) {
    msg.textContent = "‚ùå Username must be 3‚Äì20 chars";
    msg.className = "message error";
    return;
  }

  btn.disabled = true;
  msg.textContent = "Submitting‚Ä¶";
  msg.className = "message";

  try {
    const res = await fetch(`${API_BASE}/submit`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, exp })
    });

    const text = await res.text();
    if (!res.ok) throw new Error(text);

    registeredUsername = username;
    sessionStorage.setItem("aurababyUsername", username);

    msg.textContent = "‚úÖ Saved!";
    msg.className = "message success";

    fetchLeaderboard();
  } catch (err) {
    console.error(err);
    msg.textContent = "‚ùå Submit failed";
    msg.className = "message error";
  } finally {
    btn.disabled = false;
  }
}

/* ================= FETCH LEADERBOARD ================= */

async function fetchLeaderboard() {
  const list = document.getElementById("leaderboardList");

  try {
    const res = await fetch(`${API_BASE}/leaderboard`);
    if (!res.ok) throw new Error("Fetch failed");

    const data = await res.json();
    data.sort((a,b) => b.exp - a.exp);

    list.innerHTML = "";

    if (!data.length) {
      list.innerHTML = "<div>No players yet</div>";
      return;
    }

    data.slice(0,10).forEach((u,i) => {
      const div = document.createElement("div");
      div.className = "leaderboard-item";
      div.innerHTML = `
        <div class="rank">#${i+1}</div>
        <div>${escapeHtml(u.username)}</div>
        <div>${u.exp.toLocaleString()} EXP</div>
      `;
      list.appendChild(div);
    });

  } catch (err) {
    console.error(err);
    list.innerHTML = "<div>‚ùå Failed to load leaderboard</div>";
  }
}

/* ================= EVENTS ================= */

document.getElementById("submitBtn").addEventListener("click", submitUsername);
document.getElementById("usernameInput").addEventListener("keypress", e => {
  if (e.key === "Enter") submitUsername();
});

/* ================= INIT ================= */

fetchLeaderboard();
setInterval(fetchLeaderboard, 10000);
</script>

</body>
</html>
